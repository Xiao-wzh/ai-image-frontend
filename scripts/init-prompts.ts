/**
 * æ‰‹åŠ¨åˆå§‹åŒ– Platform + ProductTypePrompt æ•°æ®
 * è¿è¡Œæ–¹å¼ï¼ˆæŽ¨èï¼‰ï¼š
 *   node -r dotenv/config node_modules/tsx/dist/cli.mjs scripts/init-prompts.ts dotenv_config_path=.env.local
 */

import "dotenv/config"
import { PrismaClient } from "@prisma/client"
import { PrismaPg } from "@prisma/adapter-pg"
import pg from "pg"
import { ProductType } from "@/lib/constants"

const DATABASE_URL = process.env.DATABASE_URL
if (!DATABASE_URL) {
  console.error("âŒ DATABASE_URL æœªè®¾ç½®ï¼ˆè¯·åœ¨ .env.local ä¸­é…ç½®ï¼‰")
  process.exit(1)
}

const pool = new pg.Pool({ connectionString: DATABASE_URL })
const adapter = new PrismaPg(pool)
const prisma = new PrismaClient({ adapter })

async function main() {
  console.log("ðŸš€ æ­£åœ¨åˆå§‹åŒ– Platform + ProductTypePrompt æ•°æ®...")

  // 1) åˆå§‹åŒ–å¹³å°
  const platforms = [
    { key: "SHOPEE", label: "è™¾çš® (Shopee)", isActive: true, sortOrder: 10 },
    { key: "AMAZON", label: "äºšé©¬é€Š (Amazon)", isActive: true, sortOrder: 20 },
    { key: "TIKTOK", label: "TikTok", isActive: true, sortOrder: 30 },
    { key: "GENERAL", label: "é€šç”¨ (General)", isActive: true, sortOrder: 1000 },
  ]

  for (const p of platforms) {
    await prisma.platform.upsert({
      where: { key: p.key },
      create: p,
      update: {
        label: p.label,
        isActive: p.isActive,
        sortOrder: p.sortOrder,
      },
    })
  }
  console.log("âœ… Platform å·²åˆå§‹åŒ–")

  // 2) è¯»å–å¹³å° id
  const platformRows = await prisma.platform.findMany({ select: { id: true, key: true } })
  const byKey = new Map(platformRows.map((p) => [p.key, p.id]))

  const shopeeId = byKey.get("SHOPEE")
  const amazonId = byKey.get("AMAZON")
  const tiktokId = byKey.get("TIKTOK")
  const generalId = byKey.get("GENERAL")

  if (!shopeeId || !amazonId || !tiktokId || !generalId) {
    throw new Error("å¹³å°åˆå§‹åŒ–å¼‚å¸¸ï¼šæœªèƒ½èŽ·å–å…¨éƒ¨å¹³å° ID")
  }

  // 3) æ¸…ç©ºç³»ç»Ÿ promptsï¼ˆä¿ç•™ç”¨æˆ·ç§æœ‰ promptsï¼šuserId != nullï¼‰
  await prisma.productTypePrompt.deleteMany({ where: { userId: null } })
  console.log("âœ… å·²æ¸…ç©ºç³»ç»Ÿé»˜è®¤ prompts")

  // 4) æ’å…¥ç³»ç»Ÿ prompts
  await prisma.productTypePrompt.createMany({
    data: [
      // Shopee
      {
        userId: null,
        platformId: shopeeId,
        productType: ProductType.MENSWEAR,
        description: "ç”·è£…",
        promptTemplate: `ç”Ÿæˆ1å¼µ2400Ã—2400åƒç´ çš„9å®®æ ¼å•†å“ä¸»åœ–ï¼ˆæ¯æ ¼ç²¾ç¢º800Ã—800åƒç´ ï¼Œç„¡ç™½é‚Šã€ç„¡æ°´å°ã€ç„¡é¡å¤–æ–‡å­—ï¼‰ï¼Œé¢¨æ ¼å¿…é ˆç¬¦åˆå°ç£è¦çš®ç”·è£é¡žç›®æœ€å¸¸è¦‹çš„é«˜è½‰æ›çŽ‡ä¸»åœ–è¨­è¨ˆï¼ŒåŒ…æ‹¬ï¼š
â€¢ ä¹¾æ·¨å°ˆæ¥­çš„é›»å•†æŽ’ç‰ˆ
â€¢ é«˜ç´šæ„Ÿæ¨™é¡Œæ¢ï¼ˆç´…è‰² / æ©˜è‰² / æ·±è—ç­‰é«˜å°æ¯”è‰²ï¼‰
â€¢ åœ“å½¢æˆ–æ–¹å½¢å„ªå‹¢ icon
â€¢ ç¶ å‹¾ âœ“ / ç´…å‰ âœ— å°æ¯”
â€¢ æ¸…æ™°è¦æ ¼è¡¨
â€¢ æ•´é«”è¦–è¦ºç°¡ç´„å¤§æ°£ã€ä¸é›œäº‚

**å•†å“åç¨±ï¼š\${productName}**

**é—œéµè¦æ±‚ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼šæ–‡å­—æ¸…æ™°åº¦ï¼‰**ï¼š
â€¢ æ‰€æœ‰æ–‡å­—æ”¾å¤§ 10 å€ä¾ç„¶æ¸…æ™°ï¼Œåš´ç¦äº‚ç¢¼ã€æ¨¡ç³Šã€å‡å­—
â€¢ ä½¿ç”¨æœ€ç²—æœ€é»‘çš„ç¹é«”ä¸­æ–‡ç„¡è¥¯ç·šå­—é«”ï¼ˆå¾®è»Ÿæ­£é»‘é«” / æ€æºé»‘é«” / Noto Sans TC Black ç­‰ï¼ŒBold / Heavy ä»¥ä¸Šï¼‰
â€¢ å¼·åˆ¶æ”¾å¤§å­—è·èˆ‡è¡Œè· â‰¥1.5 å€
â€¢ æ‰€æœ‰æ–‡å­—å¿…é ˆæœ‰ 2â€“4px ç™½æˆ–é»‘æé‚Šï¼ˆå¤–é™°å½± / å¤–ç™¼å…‰ï¼‰
â€¢ è‹¥æ¨¡åž‹æœ‰é¢¨éšªï¼Œè‡ªå‹•åˆ‡æ›ã€Œè¶…å¤§å­—è·ï¼‹è¶…ç²—å­—é«”ï¼‹å¼·æé‚Šã€æ¨¡å¼
â€¢ æ¨™é¡Œæ¢å­—é«”æ”¾å¤§ â‰¥20%ï¼Œç½®ä¸­é¡¯ç¤º

**åœ–ç‰‡èˆ‡å…§å®¹è¦æ±‚**ï¼š
1ï¸âƒ£ è‰²èª¿èˆ‡ç‡ˆå…‰éœ€ä¾ä¸Šå‚³ç”·è£å¯¦æ‹åœ–è‡ªå‹•èª¿æ•´ï¼ˆæ¸…æ¶¼ / å†¬å­£ / å•†å‹™ç­‰ï¼‰ï¼Œä¸å¾—å¼·åˆ¶å›ºå®šè‰²ç³»
2ï¸âƒ£ å•†å“å¤–è§€ã€é¡è‰²ã€logoã€è»Šç·šã€ç‰ˆåž‹ã€å¸ƒæ–™ã€æ¨¡ç‰¹å§¿å‹¢ **100% èˆ‡å¯¦æ‹ä¸€è‡´ï¼Œä¸å¾—ä¿®åœ–æˆ–ç¾ŽåŒ–**
3ï¸âƒ£ è‡ªå‹•ç”Ÿæˆ 9 å®®æ ¼å…§å®¹ï¼š
â€¢ æ ¼1ï¼šæ­£é¢ä¸»è¦–è¦ºï¼‹å¤§æ¨™é¡Œæ¢ï¼‹å­£ç¯€/æ ¸å¿ƒè³£é»ž
â€¢ æ ¼2ï¼šé¢æ–™ç‰¹å¯«ï¼‹å°å„ªå‹¢æ¨™ç±¤
â€¢ æ ¼3ï¼šå¤šè‰²å±•ç¤ºï¼‹3â€“4 åœ“å½¢ icon
â€¢ æ ¼4ï¼šç©¿è‘—æƒ…å¢ƒï¼ˆå´èº«/å¾ŒèƒŒ/æ‹‰ä¼¸ï¼‰
â€¢ æ ¼5ï¼šç´°ç¯€å·¥è—ç‰¹å¯«
â€¢ æ ¼6ï¼šå‡ç´šè³£é»žï¼‹åœ–ç¤º
â€¢ æ ¼7ï¼šå°æ¯”åœ–ï¼ˆä»–ç‰Œ Ã— / æœ¬å“ âœ“ï¼‰
â€¢ æ ¼8ï¼šå¤šå ´æ™¯ç©¿æ­
â€¢ æ ¼9ï¼šå®Œæ•´è¦æ ¼è¡¨

4ï¸âƒ£ å…¨éƒ¨ä½¿ç”¨ç¹é«”ä¸­æ–‡
5ï¸âƒ£ è³£é»žçœŸå¯¦åˆç†ï¼Œä¸èª‡å¼µ
6ï¸âƒ£ **æœ€çµ‚åƒ…è¼¸å‡º 1 å¼µ 2400Ã—2400 ä¹å®®æ ¼å¤§åœ–**`,
      },
      {
        userId: null,
        platformId: shopeeId,
        productType: ProductType.BEDDING,
        description: "å¯å…·",
        promptTemplate: `ç”Ÿæˆ1å¼µ2400Ã—2400åƒç´ çš„9å®®æ ¼å•†å“ä¸»åœ–ï¼ˆæ¯æ ¼ç²¾ç¢º800Ã—800åƒç´ ï¼Œç„¡ç™½é‚Šã€ç„¡æ°´å°ã€ç„¡é¡å¤–æ–‡å­—ï¼‰

éœ€æ˜Žç¢ºæŽ§åˆ¶ä»¥ä¸‹è¦–è¦ºå…ƒç´ ï¼š
â€¢ 9 æ ¼æŽ’ç‰ˆå¸ƒå±€èˆ‡æ¯”ä¾‹
â€¢ å­—é«”ï¼ˆå­—åž‹ / å¤§å° / ç²—ç´° / é¡è‰² / æé‚Š / é™°å½±ï¼‰
â€¢ æ¨™é¡Œæ¢ï¼ˆæ©˜ç´… / ç´…è‰²åº•ï¼‰
â€¢ icon é¢¨æ ¼ã€ç¶  âœ“ ç´… âœ—ã€åœ“å½¢æ¨™ç±¤
â€¢ ç±³ç™½åº•ï¼‹æš–å…‰ç‡ˆå…‰æ°›åœ
â€¢ è¡Œè·ã€å°é½Šã€é‚Šæ¡†ã€åˆ†éš”ç·šæ¨£å¼

**å•†å“åç¨±ï¼š\${productName}**

**æ–‡å­—æ¸…æ™°åº¦æœ€é«˜å„ªå…ˆ**ï¼ˆè¦å‰‡åŒç”·è£ï¼‰ï¼š
â€¢ è¶…æ¸…æ™°ç¹é«”ä¸­æ–‡ã€ç²—é»‘å­—é«”ã€æ”¾å¤§å­—è·è¡Œè·
â€¢ å…¨æ–‡å­— 2â€“4px æé‚Š
â€¢ æ¨™é¡Œæ”¾å¤§ â‰¥20%

**åœ–ç‰‡èˆ‡å…§å®¹è¦æ±‚**ï¼š
â€¢ å•†å“å¤–è§€ã€é¡è‰²ã€logoã€è§’åº¦ã€å…‰å½± **100% èˆ‡å¯¦æ‹ä¸€è‡´ï¼Œä¸å¾—ä¿®åœ–**
â€¢ æŽ’ç‰ˆèˆ‡è¦–è¦ºé¢¨æ ¼ **å¿…é ˆå®Œå…¨è¤‡è£½åƒè€ƒåœ–ï¼ˆå¤§è±†è¢«ï¼‰**

**9 æ ¼å…§å®¹çµæ§‹**ï¼š
â€¢ æ ¼1ï¼šä¸»è¦–è¦ºï¼‹å¤§æ¨™é¡Œï¼‹è³£é»žæ¨™ç±¤
â€¢ æ ¼2ï¼šæè³ª/æˆåˆ†ç‰¹å¯«
â€¢ æ ¼3ï¼šå †ç–Šåœ–ï¼‹åœ“å½¢ icon
â€¢ æ ¼4ï¼šä½¿ç”¨/è§¸æ„Ÿæƒ…å¢ƒ
â€¢ æ ¼5ï¼šåŠŸèƒ½ç‰¹å¯«ï¼‹èªªæ˜Ž
â€¢ æ ¼6ï¼šå‡ç´šè³£é»ž
â€¢ æ ¼7ï¼šå°æ¯”åœ–ï¼ˆÃ— / âœ“ï¼‰
â€¢ æ ¼8ï¼šå¤šå ´æ™¯ä½¿ç”¨
â€¢ æ ¼9ï¼šå®Œæ•´è¦æ ¼è¡¨

â€¢ æ‰€æœ‰æ–‡å­—æ¨£å¼éœ€èˆ‡åƒè€ƒåœ–å®Œå…¨ä¸€è‡´
â€¢ è³£é»žåˆç†ã€ä¸é€ å‡
â€¢ **æœ€çµ‚åªè¼¸å‡º 1 å¼µä¹å®®æ ¼å¤§åœ–**`,
      },

      // Amazon
      {
        userId: null,
        platformId: shopeeId,
        productType: ProductType.SEXY_SPECIES,
        description: "Sexyspecies",
        promptTemplate: `ç”Ÿæˆ1å¼µ2400Ã—2400åƒç´ çš„9å®®æ ¼å•†å“ä¸»åœ–ï¼ˆæ¯æ ¼ç²¾ç¢º800Ã—800åƒç´ ï¼Œç„¡ç™½é‚Šã€ç„¡æ°´å°ã€ç„¡é¡å¤–æ–‡å­—ï¼‰ï¼Œé¢¨æ ¼å’Œè¦–è¦ºç‰¹è‰²åŒ…æ‹¬ä½†ä¸é™æ–¼ï¼š
ç²—é»‘æé‚Šè¶…å¤§æ¨™é¡Œå­—é«”é¢¨æ ¼
é»ƒè‰²æˆ–ç²‰è‰²æ‰‹å¯«é«”é‡é»žæ¨™è¨»ï¼ˆå–ç‚¹æˆ–åšå·¥ç»†èŠ‚ï¼‰
é»ƒåº•åœ“åœˆæˆ–æ©¢åœ“å¼·èª¿ç´°ç¯€
å¤šè‰²å°åœ–æŽ’åˆ—æ–¹å¼èˆ‡ä½ç½®
ç´…Ã—ç¶ âœ“å°æ¯”åœ–å‘ˆç¾æ–¹å¼
è¦æ ¼è¡¨æ¡†ç·šèˆ‡æ–‡å­—æŽ’åˆ—
æ·ºç°èƒŒæ™¯ã€ä¹¾æ·¨ç‡ˆå…‰æ°›åœ
æ•´é«”é…è‰²ã€å­—é«”ç²—ç´°ã€é™°å½±ã€æé‚Š
å•†å“åç¨±ï¼š \${productName}
é—œéµè¦æ±‚ - æ–‡å­—æ¸…æ™°åº¦æœ€é«˜å„ªå…ˆï¼š
æ‰€æœ‰æ–‡å­—å¿…é ˆæ¥µåº¦æ¸…æ™°ã€æ”¾å¤§10å€ä¾ç„¶ç­†ç•«åˆ†æ˜Žã€çµ•ç„¡äº‚ç¢¼ã€æ¨¡ç³Šã€ç­†ç•«é»é€£æˆ–å‡å­—ã€‚
è«‹ä½¿ç”¨æœ€ç²—æœ€é»‘çš„ç¹é«”ä¸­æ–‡å­—é«”ï¼ˆå¦‚å¾®è»Ÿæ­£é»‘é«”ã€é‡é»‘é«”ã€Noto Sans TC Black æˆ–é¡žä¼¼ï¼‰ï¼Œç²—ç´°è‡³å°‘ Bold ä»¥ä¸Šã€‚
å¼·åˆ¶åŠ å¤§å­—é–“è·å’Œè¡Œè·ï¼ˆè‡³å°‘1.5å€ï¼‰ï¼Œé¿å…æ–‡å­—éŽæ–¼ç·Šæ¹Šã€‚
æ‰€æœ‰é‡é»žæ–‡å­—å¿…é ˆåŠ ä¸Šæ˜Žé¡¯ç™½è‰²æˆ–é»‘è‰²æé‚Šï¼ˆè‡³å°‘3-5åƒç´ å¤–é™°å½±/å¤–ç™¼å…‰ï¼‰ï¼Œç¢ºä¿é«˜å°æ¯”æ˜“è®€ã€‚
å¦‚æžœç„¡æ³•å®Œç¾Žæ¸…æ™°ï¼Œè«‹è‡ªå‹•åŠ å¤§å­—é«”ã€æ”¾å¯¬é–“è·ï¼Œå¯§å¯çœ‹èµ·ä¾†ç¨é¬†æ•£ï¼Œä¹Ÿçµ•ä¸å…è¨±æ¨¡ç³Šã€‚
è¦æ±‚ï¼š
å•†å“ä¸»é«”ï¼ˆå¤–è§€ã€æ‹¼è‰²ä½ç½®ã€é¡è‰²ã€å¸ƒæ–™ç´‹ç†ã€è¨­è¨ˆã€è»Šç·šã€logoã€ç‰ˆåž‹ï¼‰å¿…é ˆèˆ‡æˆ‘é€™æ¬¡ä¸Šå‚³çš„å¯¦æ‹åœ–100%ä¸€è‡´ï¼Œçµ•å°ä¸èƒ½ä¿®åœ–ã€æ”¹è®Šä»»ä½•ç´°ç¯€ã€‚
è‡ªå‹•æ ¹æ“šä¸Šå‚³çš„å•†å“åœ–ç‰‡æ™ºèƒ½å¡«å…¥ä»¥ä¸‹9æ ¼å…§å®¹ï¼Œä½†æ‰€æœ‰è¦–è¦ºå…ƒç´ ï¼ˆæŽ’ç‰ˆã€å­—é«”ã€æ¨™è¨»æ–¹å¼ã€èƒŒæ™¯ï¼‰å¿…é ˆèˆ‡åƒè€ƒåœ–ï¼ˆåœ–1ï¼‰å®Œå…¨ä¸€è‡´ï¼š
Â  Â - æ ¼1ï¼ˆå·¦ä¸Šï¼‰ï¼šä¸»è¦–è¦ºï¼ˆæ¨¡ç‰¹å…’ç©¿è‘—æ­£é¢æˆ–å´èº«ï¼‰+èƒŒèº«å°å›¾+é¢œè‰²ç¼©ç•¥å›¾ï¼‹ç²—é»‘å¤§æ¨™é¡Œï¼ˆä¸è¦å¤ªé•¿ï¼‰ï¼‹1~2ä¸ªåœ“å½¢æ¨™ç°½ï¼ˆå–ç‚¹æˆ–åšå·¥ç»†èŠ‚ï¼‰
Â  Â æ ¼2ï¼ˆä¸­ä¸Šï¼‰ï¼šæè³ª/æˆåˆ†ç‰¹å¯«ï¼‹å°å„ªå‹¢æ¨™ç±¤
æ ¼3ï¼ˆå³ä¸Šï¼‰ï¼šå †ç–Šåœ–æˆ–æˆåˆ†splashï¼‹3ï½ž4å€‹åœ“å½¢å„ªå‹¢icon
æ ¼4ï¼ˆå·¦ä¸­ï¼‰ï¼šäººç‰©ä½¿ç”¨æƒ…å¢ƒæˆ–è§¸æ„Ÿå±•ç¤º
æ ¼5ï¼ˆä¸­ä¸­ï¼‰ï¼šé¢æ–™/åŠŸèƒ½ç‰¹å¯«ï¼‹å„ªå‹¢æ–‡å­—
æ ¼6ï¼ˆå³ä¸­ï¼‰ï¼šå‡ç´šè³£é»žï¼ˆå¦‚åŠ åŽšã€æ›´è¼•ã€æ›´å¼·ç­‰ï¼‰ï¼‹å°æ‡‰åœ–ç¤º
æ ¼7ï¼ˆå·¦ä¸‹ï¼‰ï¼šå°æ¯”åœ–ï¼ˆå…¶ä»–æ™®é€šç”¢å“æ‰“ç´…Ã— vs æœ¬å•†å“æ‰“ç¶ âœ“ï¼‰
æ ¼8ï¼ˆä¸­ä¸‹ï¼‰ï¼šå ´æ™¯ä½¿ç”¨æƒ…å¢ƒåœ–ï¼‹æº«é¦¨å°icon
æ ¼9ï¼ˆå³ä¸‹ï¼‰ï¼šæè´¨ç»†èŠ‚å›¾
æ‰€æœ‰æ–‡å­—å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼Œå­—é«”ã€é¡è‰²ã€æé‚Šã€æ‰‹å¯«é«”æ¨£å¼å¿…é ˆèˆ‡åƒè€ƒåœ–ï¼ˆåœ–1ï¼‰å®Œå…¨ä¸€è‡´ã€‚
è‡ªå‹•æ ¹æ“šå•†å“ç‰¹æ€§ç”¢ç”Ÿåˆç†è³£é»žèˆ‡è¦æ ¼æ–‡å­—ï¼Œä½†ä¸èƒ½èª‡å¼µæˆ–é€ å‡ã€‚
æœ€çµ‚åªè¼¸å‡º1å¼µ2400Ã—2400çš„9å®®æ ¼å¤§åœ–ï¼Œä¸éœ€è¦ä»»ä½•èªªæ˜Žæ–‡å­—ã€‚`
      },

      // TikTokï¼šé»˜è®¤ç•™ç©ºç”¨äºŽæµ‹è¯•ç©ºçŠ¶æ€ï¼ˆå¦‚éœ€è¦å¯è‡ªè¡ŒåŠ ä¸€æ¡ï¼‰

      // General fallback
      {
        userId: null,
        platformId: generalId,
        productType: ProductType.MENSWEAR,
        description: "ç”·è£…",
        promptTemplate: `ï¼ˆé€šç”¨å…œåº•ï¼‰ä¸º \${productName} ç”Ÿæˆé€šç”¨ç”µå•†ä¹å®«æ ¼ä¸»å›¾ï¼Œæ–‡å­—æ¸…æ™°ã€æŽ’ç‰ˆå¹²å‡€ã€å–ç‚¹çœŸå®žã€‚`,
      },
    ],
    skipDuplicates: true,
  })

  console.log("âœ… ProductTypePrompt ç³»ç»Ÿé»˜è®¤æ•°æ®å·²åˆå§‹åŒ–")

  // 5) æ‰“å°å¹³å°->ç±»åž‹æ¦‚è§ˆ
  const summary = await prisma.platform.findMany({
    where: { isActive: true },
    orderBy: { sortOrder: "asc" },
    select: {
      key: true,
      label: true,
      prompts: {
        where: { isActive: true, userId: null },
        select: { productType: true, description: true },
      },
    },
  })

  console.log("\nðŸ“‹ å½“å‰å¹³å°é…ç½®æ¦‚è§ˆï¼š")
  for (const p of summary) {
    const types = p.prompts.map((x) => `${x.productType}${x.description ? `(${x.description})` : ""}`)
    console.log(`- ${p.key} / ${p.label}: ${types.length ? types.join(", ") : "(æš‚æ— ç±»åž‹)"}`)
  }
}

main()
  .catch((e) => {
    console.error("âŒ åˆå§‹åŒ–å¤±è´¥:", e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
    await pool.end()
  })
